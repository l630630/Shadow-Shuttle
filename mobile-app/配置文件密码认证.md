# 🔐 配置文件密码认证

## ✅ 已实现：从配置文件读取用户密码

现在可以在 `shadowd.yaml` 配置文件中设置用户名和密码。

## 📋 配置方法

### 1. 编辑配置文件

打开 `shadowd/shadowd.yaml`：

```yaml
ssh:
  port: 2222
  host_key_path: ./ssh_host_key
  authorized_keys_path: ./authorized_keys
  password_auth_enabled: true
  
  # 用户账号配置
  users:
    a0000: "your_password_here"  # 修改为你想要的密码
    admin: "admin_password"       # 修改为你想要的密码
  
  allowed_networks:
    - 0.0.0.0/0
```

### 2. 修改密码

将 `your_password_here` 改为你想要的密码，例如：

```yaml
users:
  a0000: "my_secure_password_123"
  admin: "admin_secure_pass"
```

### 3. 重启 shadowd

```bash
cd shadowd
pkill shadowd
./shadowd -config shadowd.yaml > shadowd.log 2>&1 &
```

### 4. 测试配置

```bash
cd shadowd
node test-config-users.js
```

应该看到：
```
✅ 认证成功
🎉 所有测试通过！
```

## 📱 在手机 App 中使用

### 1. 打开 App

### 2. 点击设备

### 3. 输入配置的用户名和密码

- **用户名：** `a0000`（或你配置的其他用户名）
- **密码：** 你在配置文件中设置的密码

### 4. 连接

- ✅ 使用正确的密码 → 连接成功
- ❌ 使用错误的密码 → 认证失败

## 🔍 验证

### 测试正确密码

```
用户名: a0000
密码: [你在配置文件中设置的密码]
结果: ✅ 连接成功
```

### 测试错误密码

```
用户名: a0000
密码: wrong_password
结果: ❌ 认证失败
```

## 👥 添加更多用户

在配置文件中添加更多用户：

```yaml
users:
  a0000: "password1"
  admin: "password2"
  user1: "password3"
  user2: "password4"
```

然后重启 shadowd。

## 🔐 安全建议

### ✅ 推荐做法

1. **使用强密码**
   - 至少 12 个字符
   - 包含大小写字母、数字、特号
   - 不要使用常见密码

2. **定期更换密码**
   - 每 3-6 个月更换一次
   - 修改配置文件后重启 shadowd

3. **限制用户数量**
   - 只添加需要的用户
   - 删除不再使用的账号

4. **保护配置文件**
   ```bash
   chmod 600 shadowd.yaml
   ```

### ⚠️ 注意事项

1. **不要提交密码到 Git**
   - 配置文件已在 `.gitignore` 中
   - 不要分享包含密码的配置

2. **不要使用默认密码**
   - 必须修改 `your_password_here`
   - 不要使用简单密码如 `123456`

3. **备份配置文件**
   - 定期备份 `shadowd.yaml`
   - 保存在安全的地方

## 🎯 下一步：公钥认证

配置文件密码适合开发和测试，生产环境建议使用公钥认证：

### 1. 生成密钥对

```bash
ssh-keygen -t ed25519 -f ~/.ssh/shadowd_key
```

### 2. 添加公钥到 authorized_keys

```bash
cat ~/.ssh/shadowd_key.pub >> shadowd/authorized_keys
```

### 3. 在 App 中配置私钥

- 将私钥内容复制到 App
- 使用私钥认证而不是密码

### 4. 禁用密码认证（可选）

```yaml
ssh:
  password_auth_enabled: false  # 只允许公钥认证
```

## 📝 常见问题

### Q: 修改密码后需要重启 shadowd 吗？

**A:** 是的，必须重启 shadowd 才能加载新的配置。

### Q: 可以为不同用户设置不同的权限吗？

**A:** 当前版本所有用户权限相同。未来版本会支持权限控制。

### Q: 密码存储安全吗？

**A:** 
- 配置文件权限应设为 600（只有所有者可读写）
- 密码以明文存储在配置文件中
- 生产环境建议使用公钥认证

### Q: 忘记密码怎么办？

**A:** 
1. 编辑 `shadowd.yaml`
2. 修改密码
3. 重启 shadowd

### Q: 可以使用系统用户密码吗？

**A:** 
- 当前版本不支持
- 需要集成 PAM 认证（较复杂）
- 建议使用配置文件或公钥认证

## 🧪 测试清单

- [ ] 修改了配置文件中的密码
- [ ] 重启了 shadowd
- [ ] 运行了测试脚本
- [ ] 测试通过
- [ ] 在 App 中测试连接
- [ ] 使用正确密码可以连接
- [ ] 使用错误密码无法连接

## 📚 相关文件

- `shadowd/shadowd.yaml` - 配置文件（包含用户密码）
- `shadowd/config/config.go` - 配置结构定义
- `shadowd/ssh/server.go` - SSH 服务器实现
- `shadowd/test-config-users.js` - 测试脚本

---

**现在可以使用自定义密码了！** 🎉

**重要提示：**
1. 修改 `shadowd.yaml` 中的密码
2. 重启 shadowd
3. 在 App 中使用新密码登录
