# 🔐 真实密码认证说明

## ✅ 已启用真实密码验证

现在 SSH 连接需要正确的用户名和密码，不再接受任意密码。

## 📋 有效的用户账号

### 测试账号

| 用户名 | 密码 | 说明 |
|--------|------|------|
| `a0000` | `123456` | 主要测试账号 |
| `admin` | `admin123` | 管理员账号 |
| `test` | `test123` | 测试账号 |

## 🧪 测试步骤

### 1. 在手机 App 中测试

1. **打开 App**
2. **点击设备**
3. **输入正确的用户名和密码：**
   - 用户名：`a0000`
   - 密码：`123456`
4. **点击连接**

### 2. 预期结果

✅ **正确密码：**
- 连接成功
- 显示终端界面
- 可以执行命令

❌ **错误密码：**
- 连接失败
- 显示错误信息
- 无法进入终端

## 🔍 验证真实性

### 测试正确密码

```
用户名: a0000
密码: 123456
结果: ✅ 连接成功
```

### 测试错误密码

```
用户名: a0000
密码: wrong_password
结果: ❌ 认证失败
```

### 测试不存在的用户

```
用户名: invalid_user
密码: any_password
结果: ❌ 认证失败
```

## 📊 认证流程

```
手机 App
   ↓ 输入用户名/密码
WebSocket (10.0.2.2:8022)
   ↓ 转发认证请求
SSH Server (localhost:2222)
   ↓ 验证用户名/密码
   ├─ ✅ 匹配 → 允许连接
   └─ ❌ 不匹配 → 拒绝连接
```

## 🔧 如何添加新用户

### 方法 1：修改代码（开发模式）

编辑 `shadowd/ssh/server.go`：

```go
validUsers := map[string]string{
    "a0000": "123456",
    "admin": "admin123",
    "test":  "test123",
    "newuser": "newpassword",  // 添加新用户
}
```

然后重新编译：
```bash
cd shadowd
make build
./restart-and-test.sh
```

### 方法 2：使用公钥认证（生产模式）

1. 生成 SSH 密钥对
2. 将公钥添加到 `shadowd/authorized_keys`
3. 在 App 中配置私钥
4. 禁用密码认证

## ⚠️ 安全提示

### 开发模式（当前）

- ✅ 密码验证已启用
- ✅ 只接受预定义的用户
- ⚠️ 密码硬编码在代码中
- ⚠️ 仅用于开发和测试

### 生产模式（推荐）

- ✅ 使用公钥认证
- ✅ 禁用密码认证
- ✅ 密钥存储在安全位置
- ✅ 支持密钥轮换

## 🎯 下一步

### 短期（开发）

1. ✅ 使用预定义的用户名/密码
2. ✅ 测试认证功能
3. ✅ 验证连接安全性

### 长期（生产）

1. 📅 实现公钥认证
2. 📅 集成系统用户认证（PAM）
3. 📅 添加双因素认证（2FA）
4. 📅 实现密钥管理

## 📝 常见问题

### Q: 为什么不使用系统用户密码？

**A:** 
- 开发模式下不需要创建系统用户
- 避免安全风险（不暴露系统密码）
- 方便测试和演示

### Q: 如何修改密码？

**A:**
1. 编辑 `shadowd/ssh/server.go`
2. 修改 `validUsers` 中的密码
3. 重新编译并重启 shadowd

### Q: 生产环境如何配置？

**A:**
- 使用公钥认证（最安全）
- 或集成 LDAP/Active Directory
- 或使用 PAM 系统认证

### Q: 可以添加多少个用户？

**A:**
- 开发模式：建议不超过 10 个
- 生产模式：使用数据库或 LDAP，无限制

## 🧪 测试命令

### 测试所有账号

```bash
cd shadowd
node test-real-auth.js
```

### 手动测试

```bash
# 测试正确密码
ssh -p 2222 a0000@localhost
# 输入密码: 123456

# 测试错误密码
ssh -p 2222 a0000@localhost
# 输入密码: wrong
# 应该失败
```

## 📚 相关文档

- `shadowd/ssh/server.go` - SSH 服务器实现
- `shadowd/test-real-auth.js` - 认证测试脚本
- `mobile-app/src/services/sshService.ts` - 客户端实现

---

**现在可以使用真实的密码认证了！** 🎉

**测试账号：**
- 用户名：`a0000`
- 密码：`123456`
